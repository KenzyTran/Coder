{"ast":null,"code":"import { createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createElementBlock as _createElementBlock } from \"vue\";\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_upload = _resolveComponent(\"el-upload\");\n  const _component_el_table_column = _resolveComponent(\"el-table-column\");\n  const _component_el_table = _resolveComponent(\"el-table\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  return _openBlock(), _createElementBlock(\"div\", null, [_createVNode(_component_el_upload, {\n    class: \"upload-demo\",\n    drag: \"\",\n    action: \"/api/transactions/upload\",\n    \"show-file-list\": false,\n    accept: \".csv,.xlsx\",\n    \"before-upload\": $options.beforeUpload,\n    \"on-success\": $options.handleFileSuccess,\n    \"on-error\": $options.handleFileError\n  }, {\n    default: _withCtx(() => _cache[0] || (_cache[0] = [_createElementVNode(\"i\", {\n      class: \"el-icon-upload\"\n    }, null, -1 /* HOISTED */), _createElementVNode(\"div\", {\n      class: \"el-upload__text\"\n    }, [_createTextVNode(\"Drag the CSV/XLSX file here or \"), _createElementVNode(\"em\", null, \"click to upload\")], -1 /* HOISTED */)])),\n    _: 1 /* STABLE */,\n    __: [0]\n  }, 8 /* PROPS */, [\"before-upload\", \"on-success\", \"on-error\"]), $data.transactions.length > 0 ? (_openBlock(), _createBlock(_component_el_table, {\n    key: 0,\n    data: $data.transactions,\n    style: {\n      \"width\": \"100%\"\n    }\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_table_column, {\n      type: \"index\",\n      label: \"#\",\n      width: \"50\"\n    }), _createVNode(_component_el_table_column, {\n      prop: \"tradeDate\",\n      label: \"Ngày GD\"\n    }), _createVNode(_component_el_table_column, {\n      prop: \"symbol\",\n      label: \"Mã CK\"\n    }), _createVNode(_component_el_table_column, {\n      prop: \"type\",\n      label: \"Loại GD\"\n    }), _createVNode(_component_el_table_column, {\n      prop: \"volume\",\n      label: \"Khối lượng\"\n    }), _createVNode(_component_el_table_column, {\n      prop: \"price\",\n      label: \"Giá\"\n    }), _createVNode(_component_el_table_column, {\n      prop: \"feeRate\",\n      label: \"Tỷ lệ phí\"\n    }), _createVNode(_component_el_table_column, {\n      prop: \"taxRate\",\n      label: \"Tỷ lệ thuế\"\n    }), _createVNode(_component_el_table_column, {\n      prop: \"runningBalance\",\n      label: \"Running Balance\",\n      \"cell-class-name\": $options.getBalanceClass\n    }, null, 8 /* PROPS */, [\"cell-class-name\"])]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"data\"])) : _createCommentVNode(\"v-if\", true), _createVNode(_component_el_button, {\n    type: \"primary\",\n    onClick: $options.importTransactions,\n    disabled: $data.transactions.length === 0\n  }, {\n    default: _withCtx(() => _cache[1] || (_cache[1] = [_createTextVNode(\"Import\")])),\n    _: 1 /* STABLE */,\n    __: [1]\n  }, 8 /* PROPS */, [\"onClick\", \"disabled\"])]);\n}","map":{"version":3,"names":["_createElementBlock","_createVNode","_component_el_upload","class","drag","action","accept","$options","beforeUpload","handleFileSuccess","handleFileError","default","_withCtx","_cache","_createElementVNode","_createTextVNode","_","__","$data","transactions","length","_createBlock","_component_el_table","key","data","style","_component_el_table_column","type","label","width","prop","getBalanceClass","_createCommentVNode","_component_el_button","onClick","importTransactions","disabled"],"sources":["/home/kiet/projects/agents/3_crew/engineering_team/frontend/src/components/TransactionUploader.vue"],"sourcesContent":["<template>\n  <div>\n    <el-upload\n      class=\"upload-demo\"\n      drag\n      action=\"/api/transactions/upload\"\n      :show-file-list=\"false\"\n      accept=\".csv,.xlsx\"\n      :before-upload=\"beforeUpload\"\n      :on-success=\"handleFileSuccess\"\n      :on-error=\"handleFileError\">\n      <i class=\"el-icon-upload\"></i>\n      <div class=\"el-upload__text\">Drag the CSV/XLSX file here or <em>click to upload</em></div>\n    </el-upload>\n    <el-table\n      v-if=\"transactions.length > 0\"\n      :data=\"transactions\"\n      style=\"width: 100%\">\n      <el-table-column type=\"index\" label=\"#\" width=\"50\"></el-table-column>\n      <el-table-column prop=\"tradeDate\" label=\"Ngày GD\"></el-table-column>\n      <el-table-column prop=\"symbol\" label=\"Mã CK\"></el-table-column>\n      <el-table-column prop=\"type\" label=\"Loại GD\"></el-table-column>\n      <el-table-column prop=\"volume\" label=\"Khối lượng\"></el-table-column>\n      <el-table-column prop=\"price\" label=\"Giá\"></el-table-column>\n      <el-table-column prop=\"feeRate\" label=\"Tỷ lệ phí\"></el-table-column>\n      <el-table-column prop=\"taxRate\" label=\"Tỷ lệ thuế\"></el-table-column>\n      <el-table-column\n        prop=\"runningBalance\"\n        label=\"Running Balance\"\n        :cell-class-name=\"getBalanceClass\">\n      </el-table-column>\n    </el-table>\n    <el-button type=\"primary\" @click=\"importTransactions\" :disabled=\"transactions.length === 0\">Import</el-button>\n  </div>\n</template>\n\n<script>\nimport { ElMessage } from 'element-plus';\nimport axios from 'axios';\n\nexport default {\n  data() {\n    return {\n      transactions: []\n    };\n  },\n  methods: {\n    beforeUpload(file) {\n      const isCSVOrXLSX = file.type.includes('csv') || file.type.includes('sheet');\n      if (!isCSVOrXLSX) {\n        ElMessage.error('Unsupported file format, please upload CSV/XLSX.');\n      }\n      return isCSVOrXLSX;\n    },\n    handleFileSuccess(response) {\n      this.transactions = response.map((transaction, index) => ({\n        ...transaction,\n        rowIndex: index + 1\n      }));\n    },\n    handleFileError() {\n      ElMessage.error('There was an error processing your file.');\n    },\n    async importTransactions() {\n      try {\n        const { data } = await axios.post('/api/transactions/import', {\n          transactions: this.transactions,\n          userId: 'user123' // Hardcoded user id for the example\n        });\n        if (data.errors.length === 0) {\n          ElMessage.success(`✅ Import thành công ${data.success} giao dịch.`);\n        } else {\n          data.errors.forEach((error) => {\n            ElMessage.error(`❌ Lỗi parsing/giá/khối lượng <= 0 at row: ${error.index + 1}`);\n          });\n        }\n      } catch (error) {\n        ElMessage.error('Failed to import transactions.');\n      }\n    },\n    getBalanceClass({ row }) {\n      return row.runningBalance < 0 ? 'negative-balance' : '';\n    }\n  }\n};\n</script>\n\n<style scoped>\n.upload-demo {\n  margin-bottom: 20px;\n}\n.el-upload__text {\n  font-size: 16px;\n}\n.negative-balance {\n  background-color: yellow;\n  color: red;\n}\n</style> "],"mappings":";;;;;;uBACEA,mBAAA,CAgCM,cA/BJC,YAAA,CAWYC,oBAAA;IAVVC,KAAK,EAAC,aAAa;IACnBC,IAAI,EAAJ,EAAI;IACJC,MAAM,EAAC,0BAA0B;IAChC,gBAAc,EAAE,KAAK;IACtBC,MAAM,EAAC,YAAY;IAClB,eAAa,EAAEC,QAAA,CAAAC,YAAY;IAC3B,YAAU,EAAED,QAAA,CAAAE,iBAAiB;IAC7B,UAAQ,EAAEF,QAAA,CAAAG;;IAVjBC,OAAA,EAAAC,QAAA,CAWM,MAA8BC,MAAA,QAAAA,MAAA,OAA9BC,mBAAA,CAA8B;MAA3BX,KAAK,EAAC;IAAgB,4BACzBW,mBAAA,CAA0F;MAArFX,KAAK,EAAC;IAAiB,IAZlCY,gBAAA,CAYmC,iCAA+B,GAAAD,mBAAA,CAAwB,YAApB,iBAAe,E;IAZrFE,CAAA;IAAAC,EAAA;kEAeYC,KAAA,CAAAC,YAAY,CAACC,MAAM,Q,cAD3BC,YAAA,CAiBWC,mBAAA;IA/BfC,GAAA;IAgBOC,IAAI,EAAEN,KAAA,CAAAC,YAAY;IACnBM,KAAmB,EAAnB;MAAA;IAAA;;IAjBNd,OAAA,EAAAC,QAAA,CAkBM,MAAqE,CAArEX,YAAA,CAAqEyB,0BAAA;MAApDC,IAAI,EAAC,OAAO;MAACC,KAAK,EAAC,GAAG;MAACC,KAAK,EAAC;QAC9C5B,YAAA,CAAoEyB,0BAAA;MAAnDI,IAAI,EAAC,WAAW;MAACF,KAAK,EAAC;QACxC3B,YAAA,CAA+DyB,0BAAA;MAA9CI,IAAI,EAAC,QAAQ;MAACF,KAAK,EAAC;QACrC3B,YAAA,CAA+DyB,0BAAA;MAA9CI,IAAI,EAAC,MAAM;MAACF,KAAK,EAAC;QACnC3B,YAAA,CAAoEyB,0BAAA;MAAnDI,IAAI,EAAC,QAAQ;MAACF,KAAK,EAAC;QACrC3B,YAAA,CAA4DyB,0BAAA;MAA3CI,IAAI,EAAC,OAAO;MAACF,KAAK,EAAC;QACpC3B,YAAA,CAAoEyB,0BAAA;MAAnDI,IAAI,EAAC,SAAS;MAACF,KAAK,EAAC;QACtC3B,YAAA,CAAqEyB,0BAAA;MAApDI,IAAI,EAAC,SAAS;MAACF,KAAK,EAAC;QACtC3B,YAAA,CAIkByB,0BAAA;MAHhBI,IAAI,EAAC,gBAAgB;MACrBF,KAAK,EAAC,iBAAiB;MACtB,iBAAe,EAAErB,QAAA,CAAAwB;;IA7B1Bf,CAAA;iCAAAgB,mBAAA,gBAgCI/B,YAAA,CAA8GgC,oBAAA;IAAnGN,IAAI,EAAC,SAAS;IAAEO,OAAK,EAAE3B,QAAA,CAAA4B,kBAAkB;IAAGC,QAAQ,EAAElB,KAAA,CAAAC,YAAY,CAACC,MAAM;;IAhCxFT,OAAA,EAAAC,QAAA,CAgCgG,MAAMC,MAAA,QAAAA,MAAA,OAhCtGE,gBAAA,CAgCgG,QAAM,E;IAhCtGC,CAAA;IAAAC,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}